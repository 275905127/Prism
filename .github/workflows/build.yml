name: Build Flutter APK

on:
  push:
    branches: [ "main", "master" ]
  pull_request:
    branches: [ "main", "master" ]
  # 允许手动在 Actions 页面触发构建
  workflow_dispatch:

jobs:
  build:
    name: Build APK
    runs-on: ubuntu-latest

    steps:
      # 1. 拉取代码
      - uses: actions/checkout@v3

      # 2. 设置 Java 环境 (Gradle 需要)
      - uses: actions/setup-java@v3
        with:
          distribution: 'zulu'
          java-version: '17' # 对应较新的 Gradle 版本

      # 3. 设置 Flutter 环境
      - uses: subosito/flutter-action@v2
        with:
          channel: 'stable'
          # flutter-version: '3.19.0' # 你也可以指定具体版本，默认是用最新稳定版

      # 4. 下载项目依赖
      - name: Get Dependencies
        run: flutter pub get

      # 5. 生成代码 (如果有用到 build_runner，比如 json_serializable)
      # 如果你的项目没有用到 build_runner，这步会自动跳过或不做任何事，但保留着是个好习惯
      # - name: Run Build Runner
      #   run: dart run build_runner build --delete-conflicting-outputs

      # 6. 打包 Debug APK
      # 注意：为了简单起见，这里打的是 Debug 包，不需要签名配置，可以直接安装
      # 如果你需要 Release 包，后续需要配置 Keystore 密钥
      - name: Build APK
        run: flutter build apk --debug

      # 7. 上传构建产物 (APK) 到 GitHub Actions 页面
      - name: Upload APK
        uses: actions/upload-artifact@v4
        with:
          name: prism-debug-apk
          path: build/app/outputs/flutter-apk/app-debug.apk